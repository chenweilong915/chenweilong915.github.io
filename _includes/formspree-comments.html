<!-- Formspree Comments Form -->
<section id="formspree-comments">
  <div class="new-comment">
    <h3>ğŸ’¬ ç•™è¨€æ¿ / Leave a Message</h3>
    <p>æ¬¢è¿ç•™è¨€ï¼æˆ‘ä¼šåœ¨24å°æ—¶å†…é€šè¿‡é‚®ä»¶å›å¤ã€‚/ Welcome to leave a message! I will reply via email within 24 hours.</p>
    
    <form id="formspree-form" action="https://formspree.io/f/mqadwkol" method="POST">
      <fieldset>
        <label for="name">å§“å / Name <span class="required">*</span></label>
        <input type="text" id="name" name="name" required />
      </fieldset>
      
      <fieldset>
        <label for="email">é‚®ç®± / Email <span class="required">*</span></label>
        <input type="email" id="email" name="email" required />
      </fieldset>
      
      <fieldset>
        <label for="subject">ä¸»é¢˜ / Subject</label>
        <input type="text" id="subject" name="subject" placeholder="å­¦æœ¯äº¤æµ / Academic Exchange" />
      </fieldset>
      
      <fieldset>
        <label for="message">ç•™è¨€å†…å®¹ / Message <span class="required">*</span></label>
        <textarea id="message" name="message" rows="6" required placeholder="è¯·åœ¨è¿™é‡Œå†™ä¸‹æ‚¨çš„ç•™è¨€..."></textarea>
      </fieldset>
      
      <!-- Hidden fields for organization -->
      <input type="hidden" name="_subject" value="ğŸ”” æ–°ç•™è¨€ - é™ˆä¼Ÿé¾™çš„ä¸ªäººç½‘ç«™" />
      <input type="hidden" name="_language" value="zh" />
      
      <fieldset>
        <button type="submit" id="submit-btn">
          ğŸ“¤ å‘é€ç•™è¨€ / Send Message
        </button>
      </fieldset>
    </form>
    
    <!-- Success message -->
    <div id="success-message" style="display: none;">
      <h4>âœ… ç•™è¨€å‘é€æˆåŠŸï¼/ Message Sent Successfully!</h4>
      <p>æ„Ÿè°¢æ‚¨çš„ç•™è¨€ï¼æˆ‘å·²æ”¶åˆ°æ‚¨çš„æ¶ˆæ¯ï¼Œä¼šå°½å¿«å›å¤ã€‚<br>
      <span style="color: gray;">Thank you for your message! I have received it and will reply soon.</span></p>
    </div>
  </div>
</section>

<style>
.new-comment {
  max-width: 800px;
  margin: 30px auto;
  padding: 30px;
  border: 1px solid #e1e5e9;
  border-radius: 10px;
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.new-comment h3 {
  margin-top: 0;
  color: #2c3e50;
  border-bottom: 3px solid #3498db;
  padding-bottom: 15px;
  text-align: center;
}

.new-comment p {
  text-align: center;
  color: #7f8c8d;
  margin-bottom: 25px;
  line-height: 1.6;
}

#formspree-form fieldset {
  margin-bottom: 20px;
  border: none;
  padding: 0;
}

#formspree-form label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #34495e;
  font-size: 14px;
}

#formspree-form input, 
#formspree-form textarea {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #ecf0f1;
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  transition: all 0.3s ease;
  background-color: #ffffff;
}

#formspree-form input:focus, 
#formspree-form textarea:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
  transform: translateY(-2px);
}

#formspree-form textarea {
  resize: vertical;
  min-height: 120px;
}

.required {
  color: #e74c3c;
  font-weight: bold;
}

#submit-btn {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
  color: white;
  padding: 15px 30px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  text-transform: none;
}

#submit-btn:hover {
  background: linear-gradient(135deg, #2980b9 0%, #1f618d 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
}

#submit-btn:active {
  transform: translateY(0);
}

#success-message {
  background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
  color: white;
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  margin-top: 20px;
}

#success-message h4 {
  margin: 0 0 10px 0;
  font-size: 18px;
}

#success-message p {
  margin: 0;
  line-height: 1.5;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .new-comment {
    margin: 20px 10px;
    padding: 20px;
  }
  
  .new-comment h3 {
    font-size: 1.3em;
  }
  
  #submit-btn {
    padding: 12px 25px;
    font-size: 14px;
  }
}

/* åŠ è½½åŠ¨ç”» */
.loading {
  opacity: 0.7;
  pointer-events: none;
}

.loading #submit-btn {
  background: #95a5a6;
  cursor: not-allowed;
}

.loading #submit-btn::after {
  content: " â³";
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('formspree-form');
  const submitBtn = document.getElementById('submit-btn');
  const successMessage = document.getElementById('success-message');
  
  // è¡¨å•æäº¤å¤„ç† - ä½¿ç”¨ AJAX é¿å…é¡µé¢è·³è½¬
  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„è¡¨å•æäº¤è¡Œä¸º
      
      // æ·»åŠ åŠ è½½çŠ¶æ€
      form.classList.add('loading');
      submitBtn.innerHTML = 'ğŸ”„ å‘é€ä¸­... / Sending...';
      
      // ç®€å•çš„è¡¨å•éªŒè¯
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const message = document.getElementById('message').value.trim();
      
      if (!name || !email || !message) {
        alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ / Please fill in all required fields');
        form.classList.remove('loading');
        submitBtn.innerHTML = 'ğŸ“¤ å‘é€ç•™è¨€ / Send Message';
        return;
      }
      
      // éªŒè¯é‚®ç®±æ ¼å¼
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€ / Please enter a valid email address');
        form.classList.remove('loading');
        submitBtn.innerHTML = 'ğŸ“¤ å‘é€ç•™è¨€ / Send Message';
        return;
      }
      
      try {
        // å‡†å¤‡è¡¨å•æ•°æ®
        const formData = new FormData(form);
        
        // å‘é€ AJAX è¯·æ±‚åˆ° Formspree
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (response.ok) {
          // æˆåŠŸæäº¤ - æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å¹¶éšè—è¡¨å•
          form.style.display = 'none';
          successMessage.style.display = 'block';
          
          // æ»šåŠ¨åˆ°æˆåŠŸæ¶ˆæ¯
          successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // 5ç§’åé‡æ–°æ˜¾ç¤ºè¡¨å•å¹¶é‡ç½®
          setTimeout(() => {
            form.style.display = 'block';
            successMessage.style.display = 'none';
            form.reset(); // æ¸…ç©ºè¡¨å•
            form.classList.remove('loading');
            submitBtn.innerHTML = 'ğŸ“¤ å‘é€ç•™è¨€ / Send Message';
          }, 5000);
          
        } else {
          // å¤„ç†é”™è¯¯å“åº”
          const data = await response.json();
          throw new Error(data.error || 'æäº¤å¤±è´¥');
        }
        
      } catch (error) {
        // é”™è¯¯å¤„ç†
        console.error('Error:', error);
        alert('ç•™è¨€å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯• / Message sending failed, please try again later');
        form.classList.remove('loading');
        submitBtn.innerHTML = 'ğŸ“¤ å‘é€ç•™è¨€ / Send Message';
      }
    });
  }
});
</script>
